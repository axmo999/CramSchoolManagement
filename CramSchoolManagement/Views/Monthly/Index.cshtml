
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Honoka.cshtml";
}

<h2>Index</h2>

@using (Html.BeginForm("Print", "Monthly", null, FormMethod.Post))
{
    <div class="form-horizontal">
        <div class="form-group">
            @Html.DropDownList("year", null, "年を選択してください", new { })
        </div>

        <div class="form-group">
            <select name="month" id="month" data-bind="options: month, optionsText: 'Text', optionsValue: 'Value', value: selectedMonth, optionsCaption: '月を選択して下さい。', enable: month().length !== 0"></select>
        </div>

        <div class="form-group">
            <input type="submit" value="月別報告書作成" class="btn btn-default" />
        </div>
    </div>
}

@section scripts{
    @Scripts.Render("~/Content/knockout")

    <script type="text/javascript">
        $(function () {

            // ★１ViewModel を定義
            var createMonthViewModel = {
                month: ko.observableArray([]),
                selectedMonth: ko.observable()
            };

            ko.applyBindings(createMonthViewModel);

            $("#year").on('change', function () {
                //都道府県ドロップダウンリストの値が変更されたら

                var Year = $(this).val();
                if (!Year) {
                    createMonthViewModel.month([]);
                }

                $.ajax({
                    type: 'GET',
                    url: '/Monthly/GetMonth',// ← URL は適宜変更
                    data: { Year: Year },
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        //市町村のデータをバインド
                        createMonthViewModel.month(data);
                        //★４ 市町村ドロップダウンリストの選択値を空("市町村を選択して下さい")にする。
                        createMonthViewModel.selectedMonth('');
                    }
                });
            });

        });

    </script>
}
